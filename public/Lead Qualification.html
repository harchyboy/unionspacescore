<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lead Qualification | UNION</title>
    <link rel="icon" type="image/svg+xml" href="union-logo.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#252525',
              secondary: '#8E8E8E',
              border: '#E6E6E6',
              muted: '#FAFAFA'
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif']
            },
            boxShadow: {
              card: '0 10px 30px rgba(15,23,42,0.08)'
            }
          }
        }
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://kit.fontawesome.com/4b37446228.js" crossorigin="anonymous"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: #f0f0f0;
      }

      input[type='range']::-webkit-slider-thumb {
        @apply bg-primary;
      }
    </style>
  </head>
  <body class="bg-[#F0F0F0]">
    <div class="flex h-screen overflow-hidden">
      <aside
        data-sidebar-placeholder
        data-active="leads"
        class="w-64 bg-white border-r border-[#E6E6E6]"
      ></aside>

      <main class="flex-1 overflow-hidden flex flex-col">
        <header
          class="bg-white border-b border-[#E6E6E6] px-8 py-5 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
        >
          <div>
            <p class="text-xs text-secondary uppercase tracking-widest mb-1">Lead Qualification</p>
            <h1 id="lead-title" class="text-3xl font-semibold text-primary">Lead</h1>
            <p id="lead-subtitle" class="text-sm text-secondary mt-1">
              Apply BANT scoring, validate bonus signals, and align the right property match.
            </p>
          </div>
          <div class="flex items-center gap-3">
            <a
              href="Leads Dashboard.html"
              class="px-4 py-2 text-sm border border-[#E6E6E6] rounded-lg text-primary hover:bg-muted transition"
            >
              Back to leads
            </a>
            <a
              id="open-detail-link"
              target="_blank"
              rel="noreferrer"
              class="px-4 py-2 text-sm border border-[#E6E6E6] rounded-lg text-primary hover:bg-muted transition"
            >
              View Property Detail
            </a>
            <button
              id="save-progress"
              class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-opacity-90 transition"
            >
              Save &amp; Progress
            </button>
          </div>
        </header>

        <section class="flex-1 overflow-y-auto px-8 py-6 space-y-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-6">
              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm space-y-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                  <div>
                    <p class="text-xs text-secondary uppercase tracking-wider">BANT Score</p>
                    <div class="flex items-end gap-3 mt-2">
                      <p id="bant-score" class="text-4xl font-semibold text-primary">0</p>
                      <span class="text-secondary text-sm">/ 100 pts</span>
                    </div>
                  </div>
                  <div>
                    <p class="text-xs text-secondary uppercase tracking-wider">Bonus</p>
                    <div class="flex items-end gap-3 mt-2">
                      <p id="bonus-score" class="text-3xl font-semibold text-primary">0</p>
                      <span class="text-secondary text-sm">/ 20 pts</span>
                    </div>
                  </div>
                  <div>
                    <p class="text-xs text-secondary uppercase tracking-wider">Total</p>
                    <div class="flex items-end gap-3 mt-2">
                      <p id="total-score" class="text-4xl font-semibold text-primary">0</p>
                      <span class="text-secondary text-sm">/ 120 pts</span>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-secondary uppercase tracking-wider">Grade</p>
                    <div id="grade-badge" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-slate-100 text-slate-700 mt-2">
                      U — Unqualified
                    </div>
                    <p id="grade-description" class="text-xs text-secondary mt-1">
                      Provide inputs to unlock the grade.
                    </p>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                  <div class="space-y-2" data-bant-block="budget">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-semibold text-primary">Budget</p>
                      <span class="text-xs text-secondary" id="budget-points">0 pts</span>
                    </div>
                    <select
                      class="w-full border border-[#E6E6E6] rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:outline-none"
                      data-bant-select="budget"
                    >
                      <option value="0">Unknown</option>
                      <option value="5">Under £10k annual</option>
                      <option value="10">£10k-£24k annual</option>
                      <option value="15">£25k-£49k annual</option>
                      <option value="20">£50k-£99k annual</option>
                      <option value="25">£100k+ annual</option>
                    </select>
                    <input
                      type="range"
                      min="0"
                      max="25"
                      step="5"
                      class="w-full accent-primary"
                      data-bant-slider="budget"
                      readonly
                    />
                  </div>

                  <div class="space-y-2" data-bant-block="authority">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-semibold text-primary">Authority</p>
                      <span class="text-xs text-secondary" id="authority-points">0 pts</span>
                    </div>
                    <select
                      class="w-full border border-[#E6E6E6] rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:outline-none"
                      data-bant-select="authority"
                    >
                      <option value="0">Unknown</option>
                      <option value="5">Individual Contributor</option>
                      <option value="10">Coordinator / Assistant</option>
                      <option value="15">Manager</option>
                      <option value="20">VP / Director</option>
                      <option value="25">C-Level / Owner</option>
                    </select>
                    <input type="range" min="0" max="25" step="5" data-bant-slider="authority" class="w-full accent-primary" readonly />
                  </div>

                  <div class="space-y-2" data-bant-block="need">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-semibold text-primary">Need</p>
                      <span class="text-xs text-secondary" id="need-points">0 pts</span>
                    </div>
                    <select
                      class="w-full border border-[#E6E6E6] rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:outline-none"
                      data-bant-select="need"
                    >
                      <option value="0">Unknown</option>
                      <option value="5">Exploring - 6+ months</option>
                      <option value="10">Low - 3-6 months</option>
                      <option value="15">Medium - 1-3 months</option>
                      <option value="20">High - within 1 month</option>
                      <option value="25">Critical - Immediate</option>
                    </select>
                    <input type="range" min="0" max="25" step="5" data-bant-slider="need" class="w-full accent-primary" readonly />
                  </div>

                  <div class="space-y-2" data-bant-block="timeline">
                    <div class="flex items-center justify-between">
                      <p class="text-sm font-semibold text-primary">Timeline</p>
                      <span class="text-xs text-secondary" id="timeline-points">0 pts</span>
                    </div>
                    <select
                      class="w-full border border-[#E6E6E6] rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:outline-none"
                      data-bant-select="timeline"
                    >
                      <option value="0">Unknown</option>
                      <option value="5">Future (6+ months)</option>
                      <option value="10">Long-term (3-6 months)</option>
                      <option value="15">Medium-term (1-3 months)</option>
                      <option value="20">Short-term (2-4 weeks)</option>
                      <option value="25">Immediate (&lt; 2 weeks)</option>
                    </select>
                    <input type="range" min="0" max="25" step="5" data-bant-slider="timeline" class="w-full accent-primary" readonly />
                  </div>
                </div>
              </div>

              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm space-y-4">
                <div class="flex items-center justify-between">
                  <h2 class="text-lg font-semibold text-primary">Bonus Scoring</h2>
                  <span class="text-xs text-secondary">Push signal-driven uplift</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <label class="text-xs font-semibold text-secondary uppercase">Property Fit</label>
                    <select
                      data-bonus-select="propertyFit"
                      class="w-full mt-1 px-3 py-2 border border-[#E6E6E6] rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                    >
                      <option value="-5">No suitable properties (-5)</option>
                      <option value="2">Limited options (+2)</option>
                      <option value="5">Good alternatives (+5)</option>
                      <option value="10">Perfect match (+10)</option>
                    </select>
                  </div>
                  <div>
                    <label class="text-xs font-semibold text-secondary uppercase">Source Quality</label>
                    <select
                      data-bonus-select="sourceQuality"
                      class="w-full mt-1 px-3 py-2 border border-[#E6E6E6] rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                    >
                      <option value="0">Cold outreach (+0)</option>
                      <option value="2">Inbound call (+2)</option>
                      <option value="3">Website direct (+3)</option>
                      <option value="5">Broker referral (+5)</option>
                      <option value="5">Existing client referral (+5)</option>
                    </select>
                  </div>
                  <div>
                    <label class="text-xs font-semibold text-secondary uppercase">Company Profile</label>
                    <select
                      data-bonus-select="companyProfile"
                      class="w-full mt-1 px-3 py-2 border border-[#E6E6E6] rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
                    >
                      <option value="0">Individual (+0)</option>
                      <option value="2">Startup (+2)</option>
                      <option value="3">Growing company (+3)</option>
                      <option value="5">Recognized brand (+5)</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                  <h2 class="text-lg font-semibold text-primary">Qualification Status</h2>
                  <span id="priority-text" class="text-xs text-secondary">Action recommendations</span>
                </div>
                <div id="status-badges" class="flex flex-wrap gap-2 mb-4"></div>
                <div id="bant-health" class="grid grid-cols-1 md:grid-cols-4 gap-3"></div>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm space-y-4">
                <div class="flex items-center justify-between">
                  <h2 class="text-lg font-semibold text-primary">Tenant Requirements</h2>
                  <span class="text-xs text-secondary">Snapshot</span>
                </div>
                <dl class="space-y-3 text-sm">
                  <div class="flex items-center justify-between">
                    <dt class="text-secondary">Size</dt>
                    <dd id="req-size" class="font-semibold text-primary"></dd>
                  </div>
                  <div class="flex items-center justify-between">
                    <dt class="text-secondary">Locations</dt>
                    <dd id="req-locations" class="font-semibold text-primary text-right"></dd>
                  </div>
                  <div class="flex items-center justify-between">
                    <dt class="text-secondary">Budget Range</dt>
                    <dd id="req-budget" class="font-semibold text-primary"></dd>
                  </div>
                  <div class="flex items-center justify-between">
                    <dt class="text-secondary">Timeline</dt>
                    <dd id="req-timeline" class="font-semibold text-primary"></dd>
                  </div>
                  <div>
                    <dt class="text-secondary mb-1">Notes</dt>
                    <dd id="req-notes" class="text-sm text-primary"></dd>
                  </div>
                </dl>
              </div>

              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm space-y-4">
                <div class="flex items-center justify-between">
                  <h2 class="text-lg font-semibold text-primary">Recommended Properties</h2>
                  <span class="text-xs text-secondary">Suitability index</span>
                </div>
                <div id="recommended-grid" class="grid grid-cols-1 gap-4"></div>
              </div>

              <div class="bg-white border border-[#E6E6E6] rounded-2xl p-6 shadow-sm space-y-4">
                <div class="flex items-center justify-between">
                  <h2 class="text-lg font-semibold text-primary">Alternative Options</h2>
                  <span class="text-xs text-secondary">Keep pipeline warm</span>
                </div>
                <div id="alternative-list" class="space-y-3"></div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="toast-root" class="fixed bottom-8 right-8 space-y-3 z-50"></div>

    <script src="leads-data.js"></script>
    <script src="sidebar.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const leadId = params.get('id');
        const leads = window.LEADS_DATA || [];
        const lead = leadId ? leads.find((item) => item.id === leadId) : leads[0];

        if (!lead) {
          alert('Lead not found. Redirecting to dashboard.');
          window.location.href = 'Leads Dashboard.html';
          return;
        }

        const bantSelects = document.querySelectorAll('[data-bant-select]');
        const bantSliders = document.querySelectorAll('[data-bant-slider]');
        const bonusSelects = document.querySelectorAll('[data-bonus-select]');

        document.getElementById('lead-title').textContent = `${lead.contact.name} · ${lead.company}`;
        document.getElementById('lead-subtitle').textContent = `${lead.reference} · ${lead.source} · ${lead.status}`;
        document.getElementById('open-detail-link').href = `Lead Qualification.html?id=${lead.id}`;

        document.getElementById('req-size').textContent = lead.requirement.size;
        document.getElementById('req-locations').textContent = lead.requirement.locations.join(', ');
        document.getElementById('req-budget').textContent = lead.requirement.budgetRange;
        document.getElementById('req-timeline').textContent = lead.requirement.timeline;
        document.getElementById('req-notes').textContent = lead.requirement.notes;

        bantSelects.forEach((select) => {
          const key = select.dataset.bantSelect;
          const value = lead.bant[key];
          select.value = value.toString();
        });
        bantSliders.forEach((slider) => {
          const key = slider.dataset.bantSlider;
          slider.value = lead.bant[key];
        });

        bonusSelects.forEach((select) => {
          const key = select.dataset.bonusSelect;
          select.value = lead.bonus[key];
        });

        const statusContainer = document.getElementById('status-badges');
        statusContainer.innerHTML = lead.qualificationStatus
          .map(
            (status) => `
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-muted text-primary border border-[#E6E6E6]">
                ${status}
              </span>
            `
          )
          .join('');

        renderProperties('recommended-grid', lead.propertyMatches);
        renderAlternatives(lead.alternativeProperties);

        ;['budget', 'authority', 'need', 'timeline'].forEach((key) => {
          document.querySelector(`[data-bant-block="${key}"] select`).addEventListener('change', (event) => {
            document.querySelector(`[data-bant-slider="${key}"]`).value = event.target.value;
            lead.bant[key] = Number(event.target.value);
            updateScore();
          });
        });

        bonusSelects.forEach((select) => {
          select.addEventListener('change', (event) => {
            lead.bonus[select.dataset.bonusSelect] = Number(event.target.value);
            updateScore();
          });
        });

        document.getElementById('save-progress').addEventListener('click', () => {
          pushToast(`Lead ${lead.reference} updated and synced to CRM.`);
        });

        updateScore();

        function updateScore() {
          const bantScore = lead.bant.budget + lead.bant.authority + lead.bant.need + lead.bant.timeline;
          const bonusScore = lead.bonus.propertyFit + lead.bonus.sourceQuality + lead.bonus.companyProfile;
          const hasUnknown = Object.values(lead.bant).some((points) => points === 0);
          const gradeInfo =
            window.LEAD_UTILS?.determineGradeFromScore(bantScore, hasUnknown) || {
              grade: 'U',
              color: 'bg-slate-100 text-slate-700',
              description: 'Awaiting inputs — capture BANT data.',
              priority: 'Gather missing information before progressing.'
            };

          document.getElementById('bant-score').textContent = bantScore;
          document.getElementById('bonus-score').textContent = bonusScore;
          document.getElementById('total-score').textContent = bantScore + bonusScore;

          document.getElementById('budget-points').textContent = `${lead.bant.budget} pts`;
          document.getElementById('authority-points').textContent = `${lead.bant.authority} pts`;
          document.getElementById('need-points').textContent = `${lead.bant.need} pts`;
          document.getElementById('timeline-points').textContent = `${lead.bant.timeline} pts`;

          const gradeBadge = document.getElementById('grade-badge');
          gradeBadge.textContent = `${gradeInfo.grade} — ${gradeInfo.description.split('—')[0].trim()}`;
          gradeBadge.className = `inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${gradeInfo.color}`;
          document.getElementById('grade-description').textContent = gradeInfo.description;
          document.getElementById('priority-text').textContent = gradeInfo.priority;

          renderBantHealth();
        }

        function renderBantHealth() {
          const container = document.getElementById('bant-health');
          const ranges = [
            { key: 'budget', label: 'Budget' },
            { key: 'authority', label: 'Authority' },
            { key: 'need', label: 'Need' },
            { key: 'timeline', label: 'Timeline' }
          ];

          container.innerHTML = ranges
            .map((range) => {
              const score = lead.bant[range.key];
              const color =
                score >= 20 ? 'bg-emerald-100 text-emerald-700' : score >= 10 ? 'bg-amber-100 text-amber-700' : 'bg-rose-100 text-rose-700';
              return `
                <div class="p-3 rounded-lg border border-[#E6E6E6]">
                  <p class="text-xs text-secondary uppercase">${range.label}</p>
                  <p class="text-sm font-semibold mt-1">${score} pts</p>
                  <span class="inline-flex mt-2 px-2 py-0.5 rounded-full text-xs font-medium ${color}">
                    ${score === 0 ? 'Unknown' : score >= 20 ? 'Verified' : score >= 10 ? 'In progress' : 'At risk'}
                  </span>
                </div>
              `;
            })
            .join('');
        }

        function renderProperties(targetId, properties) {
          const container = document.getElementById(targetId);
          container.innerHTML = properties
            .map(
              (property) => `
                <div class="border border-[#E6E6E6] rounded-xl p-4 flex gap-4">
                  <img src="${property.image}" alt="${property.name}" class="w-20 h-20 rounded-lg object-cover" />
                  <div class="flex-1">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-semibold text-primary">${property.name}</p>
                        <p class="text-xs text-secondary">${property.location} · ${property.size}</p>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-semibold text-primary">${property.fit}% fit</p>
                        <div class="w-20 bg-muted rounded-full h-1.5 mt-1 overflow-hidden">
                          <div class="h-full bg-primary" style="width:${property.fit}%"></div>
                        </div>
                      </div>
                    </div>
                    <div class="flex gap-2 mt-3">
                      <a
                        href="${property.actions.view}"
                        class="px-3 py-1.5 text-xs rounded-lg border border-[#E6E6E6] hover:border-primary transition"
                      >
                        View Property
                      </a>
                      <a
                        href="${property.actions.proposal}"
                        class="px-3 py-1.5 text-xs rounded-lg bg-primary text-white hover:bg-opacity-90 transition"
                      >
                        Send Proposal
                      </a>
                    </div>
                  </div>
                </div>
              `
            )
            .join('');
        }

        function renderAlternatives(properties) {
          const container = document.getElementById('alternative-list');
          container.innerHTML = properties
            .map(
              (property) => `
                <div class="flex items-center justify-between border border-[#E6E6E6] rounded-lg px-4 py-3">
                  <div>
                    <p class="text-sm font-semibold text-primary">${property.name}</p>
                    <p class="text-xs text-secondary">${property.location} • ${property.size}</p>
                  </div>
                  <span class="text-xs font-semibold px-2.5 py-0.5 rounded-full bg-muted text-primary">
                    ${property.fit}% fit
                  </span>
                </div>
              `
            )
            .join('');
        }

        function pushToast(message) {
          const root = document.getElementById('toast-root');
          const toast = document.createElement('div');
          toast.className = 'bg-primary text-white px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2';
          toast.innerHTML = `<i class="fa-solid fa-circle-check text-emerald-300"></i><span class="text-sm">${message}</span>`;
          root.appendChild(toast);
          setTimeout(() => toast.remove(), 3200);
        }
      });
    </script>
  </body>
</html>

